Mind Wurld Open
===============

A port of Apex Open Wurld, as demoed at Kscope15, to Node.

That's telekinesis, Kyle.

Instructions
------------

To get started;

* Make sure you've got Node.js installed, plus the Socket.io, MQTT, Express, and Body Parser modules via npm.
* Start up the server with "node server.js" from the command line.
* Use a browser of your choice (i.e. Chrome) to connect to "http://your.server.ip:4004/"
* Wait for stuff to load.
* Hit a key, click the mouse, or press a button on your gamepad.

You can walk around and marvel at the glitchy physics and the bad garbage collection. Find treasure and liberate captured pigs. But don't go too far, only a small section of the map has been ported to static json files.

Tested with Firefox and Chrome, on a MacBook Pro Retina, running OS X El Capitan, with a Playstation Dualshock 4 (urban camouflage) controller. A Digital Storm custom gaming PC, running Windows 10, with XBox One controller. And an Alienware Alpha, running Windows 8.1, with XBox 360 controller. The controller client was tested in Chrome on a Nexus 5X.

YMMV.

Controls
--------

You'll always be able to do these, even if "client actions" are turned off (see Configuration below) although they can also be controlled via remote messages (see Remote Control, below).

* **Walk** - W and S, gamepad Left Stick.
* **Turn** - A and D, gamepad Right Stick.
* **Toggle Music** - M key, gamepad Triangle (Y on XBox controllers).
* **Switch Skin** - Left / Right cursor keys, controller d-pad Left / Right (Up / Down in Firefox).
* **Restart** - Browser refresh, R key, or on gamepad; PS button, Back, Menu, Options, or Share.

These actions are _supposed_ to be triggered remotely, but the end-user can perform them directly if "client actions" are enabled. In which case the controls are;

* **Jump or Swim Up** - Spacebar, Cross / A button.
* **Spawn Pig** - P key,  gamepad Square (X on XBox).
* **Open Chest** - O key, Circle / B button.
* **Release Pigs** - I key, gamepad R1 / RB.

Hint
----

There is some stuff on a different island, and you can't _quite_ hold your breath long enough to get there!

Remote Control
--------------

You can also use another browser (e.g. one on a phone) to connect to "http://your.server.ip:4004/ctrlr" and use the buttons in the UI to post actions back to the server. Those actions will publish messages to the "mindwurld" topic on an MQTT broker. You can either run your own, locally (in which case you'll have to change server.js accordingly), or use something like [Mosca's](http://mosca.io/) test server. The wurld server listens for messages on that topic, and broadcasts them out to the clients, via socket.io, which controls the 3D experience.

You should also be able to send messages to the broker from any MQTT client, e.g.

    mqtt publish -t mindwurld -h 'test.mosca.io' -m '{"op":"toggle_music"}'

Alternatively, the controller client, or your own integrations, can bypass the MQTT broker entirely. The server understands POSTs to /ctrlr/ACTION, with a body containing a serialized JSON object of the same format as mentioned above, but with the "comm" attribute set to "sock". In that case, it will not publish a message to the MQTT broker, but will instead send the operation directly on to the 3D client via socket.io reducing the latency of going through a broker. In the controller client this behaviour can be enabled by checking the "Use direct comms" checkbox. Or, you can make those posts yourself, from wherever you like. For example;

    $.ajax({
      url:'http://my.server.ip:4004/ctrlr/ACTION',
      method:'POST',
      dataType:'json',
      data:JSON.stringify({op:'toggle_music',comm:'sock'}),
      contentType:'application/json',
      processData:false
    });

Supported OPs (i.e. operations), which could be generated by any external peripheral you like, and the actions they perform in the wurld are;

* **lift** - Open a chest, if one is nearby. Maybe it'll have treasure.
* **push** - Remove a nearby fence and set the pigs free.
* **jump** - Jump, jump, jump around. Or swim upwards to take a breath.
* **love** - Spawn a lovely pig near the player. Everyone loves pigs.

Also, you can send the following messages. They all start moving, in the direction specified, and for the amount of time specified by the relevant timeout setting in the wurld-settings.js file. If another similar message is received before the timeout then the player will carry on moving, otherwise they'll stop. Thus the user _could_ navigate the world entirely via remote control.

* **left** - Turn left
* **walk** - Walk forwards
* **right** - Turn right

Additionally, for test purposes (or just fun!) it understands;

* **toggle_music** - Turn music on and off.
* **prev_skin** - Switch the players skin to the next available skin.
* **next_skin** - The opposite of above.
* **reload_page** - Refreshes the browser page, essentially reloading and resetting the wurld.

The indicator icons, which match the buttons in the controller UI, at the bottom of the browser window _should_ flash to indicate that the client has received a message from an external source.

Configuration
-------------

Many settings are stored in wurld-settings.js that get picked up when the client is loaded by the browser.

The most important of these is "allow_client_actions" you should set this to false to prevent the end-user from doing, with the keyboard or gamepad, things that should happen via messages sent from remote clients.

Feel free to tweak the other settings, but be prepared to break stuff.

TODO
----

* Add total completion message with timings (limit to 5 minutes?) and persistent (e.g. nedb) leaderboard

Credits
-------

* [USGS](http://ned.usgs.gov/) Elevation data, via the US Geological Survey's point query service.
* [Three.js](http://threejs.org/) Making WebGL easier to use since 2010.
* [Howler.js](https://github.com/goldfire/howler.js/) Howler.js a JavaScript audio library for modern web applications.
* [Keypress](http://dmauro.github.io/Keypress/) A robust JavaScript library for capturing keyboard input. Surprisingly important.
* [Seedrandom](https://github.com/davidbau/seedrandom) A predictable, portable, seedable random number generator, for JavaScript.
* [Matter.js](http://brm.io/matter-js/index.html) and [Poly-Decomp](https://github.com/schteppe/poly-decomp.js) For providing physics based movement and simple collision detection.
* [Clara.io](https://clara.io/) Browser based 3D modeling, for free.
* [BDCraft](http://bdcraft.net/) Beautiful high-resolution textures, for some game I've never heard of. Craftmine or somesuch.
* [Longzijun](https://longzijun.wordpress.com/) Incredibly talented musician, poet, writer, and photographer.
* [Soundbible](http://soundbible.com/) and [Freesound](http://freesound.org/) Anything you want to make the sound of, it'll be there somewhere.
* [Media.io](http://media.io/) Online audio format converter.
* [Icons8](https://icons8.com/) If there's an icon you think you need, and it isn't here, you don't need it.
* [Github](https://github.com/) Source code repository hosting, endless inspiration from people way smarter than me.
* [Stack Overflow](http://stackoverflow.com/) If there's a question you think you need the answer to, and it isn't here, you don't need to know.
* [Shader Particle Engine](http://www.github.com/squarefeet) by Luke Moody. A ... err ... engine that makes particles with shaders.
